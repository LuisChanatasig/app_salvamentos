<!doctype html>
<html lang="es" data-layout="vertical" data-topbar="light" data-sidebar="light" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable">
<head>
    @await Html.PartialAsync("_title_meta")
    @RenderSection("styles", required: false)
    @await Html.PartialAsync("_head_css")
</head>
<body>
    <!-- Begin page -->
    <div id="layout-wrapper">
        @await Html.PartialAsync("_menu")

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    @*  @await Html.PartialAsync("_page_title") *@

                    @RenderBody()

                    <div class="modal fade" id="modalCasos" tabindex="-1" aria-labelledby="modalCasosLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl modal-dialog-scrollable">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalCasosLabel">📋 Listado de Casos</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                                </div>
                                <div class="modal-body" id="contenidoCasosModal">
                                    <!-- Aquí se cargará la vista parcial -->
                                    <div class="text-center my-5">
                                        <div class="spinner-border text-primary" role="status"></div>
                                        <p class="mt-3">Cargando casos...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            @await Html.PartialAsync("_footer")
        </div>

    </div>
    <!-- END layout-wrapper -->
    @await Html.PartialAsync("_vendor_scripts")

    @RenderSection("scripts", required: false)

    <script>
        var timeout = 30 * 60 * 1000; // 30 minutos en milisegundos

        var logoutTimer = setTimeout(logout, timeout);

        function logout() {
            window.location.href = "@Url.Action("SignIn", "Authentication")"; // Redirige al login
        }

        function resetTimer() {
            clearTimeout(logoutTimer);
            logoutTimer = setTimeout(logout, timeout);
        }

        // Detectar actividad del usuario
        document.addEventListener("mousemove", resetTimer);
        document.addEventListener("keydown", resetTimer);


    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('.logo-anim').forEach(el => el.classList.add('loaded'));
        });
    </script>
    <script>
        const modal = document.getElementById('modalCasos');
        modal.addEventListener('show.bs.modal', function () {
            fetch('@Url.Action("CasosRegistradosModal", "Casos")')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('contenidoCasosModal').innerHTML = html;
                })
                .catch(error => {
                    document.getElementById('contenidoCasosModal').innerHTML =
                      '<div class="alert alert-danger">Error al cargar los casos.</div>';
                });
        });
    </script>
</body>
</html>